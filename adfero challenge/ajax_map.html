<!DOCTYPE html>
<html >
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Adfero Chanllenge</title>
    <script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAZBe7uHI90ESk2XAmWRL3RxR6u04U0tImA3bfwZ3-HKdEno7z2xRk2YE6OkudtBX5qy0vLrgbf1DUCg"
            type="text/javascript"></script>
    <script type="text/javascript">
    //<![CDATA[

    // custom icons
    var BlueIcon = new GIcon(); 
    BlueIcon.image = 'mm_20_blue.png';
    BlueIcon.iconSize = new GSize(12, 20);
    BlueIcon.shadowSize = new GSize(22, 20);
    BlueIcon.iconAnchor = new GPoint(6, 20);
    BlueIcon.infoWindowAnchor = new GPoint(5, 1);

    var RedIcon = new GIcon(); 
    RedIcon.image = 'mm_20_red.png';
    RedIcon.iconSize = new GSize(12, 20);
    RedIcon.shadowSize = new GSize(22, 20);
    RedIcon.iconAnchor = new GPoint(6, 20);
    RedIcon.infoWindowAnchor = new GPoint(5, 1);

    var myIcons = [];
    myIcons["restaurant"] = BlueIcon;
    myIcons["bar"] = RedIcon;

    // execute when the body is loaded
    function load() {
  //checking browser compatability
      if (GBrowserIsCompatible()) {
        //produce map and center it
        var map = new GMap2(document.getElementById("map"));
        map.addControl(new GSmallMapControl());
        map.addControl(new GMapTypeControl());
        map.setCenter(new GLatLng(47.614495, -122.341861), 13);

        //Load data from  xmlstuff.php 
        GDownloadUrl("xmlstuff.php", function(data) {
          var xml = GXml.parse(data);
          var markers = xml.documentElement.getElementsByTagName("marker");
          for (var i = 0; i < markers.length; i++) {
            var name = markers[i].getAttribute("name");
            var address = markers[i].getAttribute("address");
            var type = markers[i].getAttribute("type");
            var point = new GLatLng(parseFloat(markers[i].getAttribute("lat")),
                                    parseFloat(markers[i].getAttribute("lng")));
            var marker = createMarker(point, name, address, type);
            map.addOverlay(marker);
          }
        });
      }
    }

    // function for the markers
    function createMarker(point, name, address, type) {
      var marker = new GMarker(point, myIcons[type]);
      var html = "<b>" + name + "</b> <br/>" + address;
      GEvent.addListener(marker, 'click', function() {
        marker.openInfoWindowHtml(html);
      });
      return marker;
    }
    //]]>
  </script>
  </head>
 
  <body onload="load()" onunload="GUnload()">
    <div id="map" style="width: 500px; height: 300px"></div>
  </body>
</html>
